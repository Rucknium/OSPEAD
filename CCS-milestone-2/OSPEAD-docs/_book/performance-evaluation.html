<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Performance Evaluation – OSPEAD-docs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./appendix-bjr-benchmarks.html" rel="next">
<link href="./parametric-fit.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-81b089a3b74ed4cf194f083418e7130b.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a0d8cd41196b3779e6040b3024b155.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./performance-evaluation.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Performance Evaluation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">OSPEAD-docs</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./requirements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Requirements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./successful-simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Successful Simulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ring-gathering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ring Gathering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonstandard-transactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Nonstandard Transactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./broadcast-time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Broadcast Time</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./miscellaneous-preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Miscellaneous Preparation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformed-age.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Transformed Age</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bjr-and-patra-sen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">BJR and Patra-Sen</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonparametric-real-spend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Nonparametric Real Spend</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./real-spend-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Real Spend Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parametric-fit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Parametric Fit</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./performance-evaluation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Performance Evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-bjr-benchmarks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Appendix: BJR Benchmarks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#attack-success-probability" id="toc-attack-success-probability" class="nav-link active" data-scroll-target="#attack-success-probability"><span class="header-section-number">13.1</span> Attack success probability</a></li>
  <li><a href="#visualizations-of-fitted-distributions" id="toc-visualizations-of-fitted-distributions" class="nav-link" data-scroll-target="#visualizations-of-fitted-distributions"><span class="header-section-number">13.2</span> Visualizations of fitted distributions</a></li>
  <li><a href="#attack-success-probability-by-output-age" id="toc-attack-success-probability-by-output-age" class="nav-link" data-scroll-target="#attack-success-probability-by-output-age"><span class="header-section-number">13.3</span> Attack success probability by output age</a></li>
  <li><a href="#attack-success-probability-for-different-λ-weights" id="toc-attack-success-probability-for-different-λ-weights" class="nav-link" data-scroll-target="#attack-success-probability-for-different-λ-weights"><span class="header-section-number">13.4</span> Attack success probability for different λ weights</a></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code"><span class="header-section-number">13.5</span> Code</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-performance-evaluation" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Performance Evaluation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>With the parametric fit done in <a href="parametric-fit.html" class="quarto-xref"><span>Chapter 12</span></a> , we can evaluate how well the parametric distributions would protect users against the MAP Decoder attack.</p>
<p>With ring size 16, the minimum possible attack success probability is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mn>16</mn><mo>=</mo><mn>6.25</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">1/16=6.25\%</annotation></semantics></math>.</p>
<section id="attack-success-probability" class="level2 page-columns page-full" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="attack-success-probability"><span class="header-section-number">13.1</span> Attack success probability</h2>
<p><a href="#tbl-main-attack-success" class="quarto-xref">Table&nbsp;<span>13.1</span></a> shows the top six best distributions, the average attack success probability computed from <a href="parametric-fit.html#eq-map-decoder-simple" class="quarto-xref">Equation&nbsp;<span>12.1</span></a> , and the fitted parameter values. Note that some of the distributions have the same names for parameters, but they have different meanings for each parametric distribution. Consult the sources in <a href="parametric-fit.html#sec-parametric-distributions" class="quarto-xref"><span>Section 12.2</span></a> and the documentation for the distributions’ R implementations in <a href="parametric-fit.html#sec-parametric-fit-code" class="quarto-xref"><span>Section 12.4</span></a> for their meanings.</p>
<p>The lowest attack success probability is achieved by Log-GB2, the log transformation of the generalized beta distribution of the second kind. If Monero’s default decoy selection algorithm were Log-GB2 with the specified parameter values, an adversary applying the MAP decoder attack would have successfully guessed the real spend in 7.6 percent of rings, on average, since the August 2022 hard fork. That corresponds to an effective ring size of 13.2.</p>
<p>The last row of <a href="#tbl-main-attack-success" class="quarto-xref">Table&nbsp;<span>13.1</span></a> shows the estimated average attack success probability that an adversary can achieve against real Monero users who were using the default <code>wallet2</code> decoy selection algorithm, since the August 2022 hard fork: 23.5 percent. This corresponds to an effective ring size of 4.2.</p>
<div class="column-page">
<div id="tbl-main-attack-success" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-main-attack-success-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.1: Attack success probability with fitted parametric decoy distributions
</figcaption>
<div aria-describedby="tbl-main-attack-success-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 24%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Decoy distribution</th>
<th style="text-align: right;">Attack success probability</th>
<th style="text-align: left;">Param 1</th>
<th style="text-align: left;">Param 2</th>
<th style="text-align: left;">Param 3</th>
<th style="text-align: left;">Param 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Log-GB2</td>
<td style="text-align: right;">7.590%</td>
<td style="text-align: left;">shape1 = 4.462</td>
<td style="text-align: left;">scale = 20.62</td>
<td style="text-align: left;">shape2 = 0.5553</td>
<td style="text-align: left;">shape3 = 7.957</td>
</tr>
<tr class="even">
<td style="text-align: left;">Log-GEV</td>
<td style="text-align: right;">7.730%</td>
<td style="text-align: left;">location = 8.382</td>
<td style="text-align: left;">scale = 3.851</td>
<td style="text-align: left;">shape = -0.3404</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">RPLN</td>
<td style="text-align: right;">7.746%</td>
<td style="text-align: left;">shape2 = 6.684</td>
<td style="text-align: left;">meanlog = 9.725</td>
<td style="text-align: left;">sdlog = 3.964</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">GB2</td>
<td style="text-align: right;">7.794%</td>
<td style="text-align: left;">shape1 = 0.1282</td>
<td style="text-align: left;">scale = 4753</td>
<td style="text-align: left;">shape2 = 8.582</td>
<td style="text-align: left;">shape3 = 7.179</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Log-F</td>
<td style="text-align: right;">8.212%</td>
<td style="text-align: left;">df1 = 1.678</td>
<td style="text-align: left;">df2 = 9.067e+06</td>
<td style="text-align: left;">ncp = 17.06</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Log-Gamma</td>
<td style="text-align: right;">8.470%</td>
<td style="text-align: left;">shape = 4.315</td>
<td style="text-align: left;">rate = 0.3751</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Decoy status quo</td>
<td style="text-align: right;">23.540%</td>
<td style="text-align: left;">shape = 19.28</td>
<td style="text-align: left;">rate = 1.61</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</section>
<section id="visualizations-of-fitted-distributions" class="level2 page-columns page-full" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="visualizations-of-fitted-distributions"><span class="header-section-number">13.2</span> Visualizations of fitted distributions</h2>
<p><a href="#fig-decoy-distributions-top-1-3-not-log" class="quarto-xref">Figure&nbsp;<span>13.1</span></a> compares the probability mass functions of the top three fitted decoy distributions, the status quo decoy distribution, and the real spend distribution. I included the CDF of the real spend on the bottom panel because PMFs on a log scale can appear misleading.</p>
<p>Outputs in the first two minutes would usually be included in a single block. Therefore, variations in the probability mass within those two minutes are not very meaningful.</p>
<p>The figure shows that the probability mass of the status quo decoy distribution is much lower than the real spend. Therefore, the status quo decoy distribution is not doing a good job of protecting the privacy of users who spend young outputs.</p>
<div class="page-columns page-full">
<div id="fig-decoy-distributions-top-1-3-not-log" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-decoy-distributions-top-1-3-not-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.1
</figcaption>
<div aria-describedby="fig-decoy-distributions-top-1-3-not-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/decoy-distributions-top-1-3-not-log.png" id="fig-decoy-distributions-top-1-3-not-log" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<p><a href="#fig-decoy-distributions-top-4-6-not-log" class="quarto-xref">Figure&nbsp;<span>13.2</span></a> shows the PMFs of the top 4-6 distributions from <a href="#tbl-main-attack-success" class="quarto-xref">Table&nbsp;<span>13.1</span></a> .</p>
<div class="page-columns page-full">
<div id="fig-decoy-distributions-top-4-6-not-log" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-decoy-distributions-top-4-6-not-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.2
</figcaption>
<div aria-describedby="fig-decoy-distributions-top-4-6-not-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/decoy-distributions-top-4-6-not-log.png" id="fig-decoy-distributions-top-4-6-not-log" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<p><a href="#fig-decoy-distributions-top-1-3-log" class="quarto-xref">Figure&nbsp;<span>13.3</span></a> is the same plot as <a href="#fig-decoy-distributions-top-1-3-not-log" class="quarto-xref">Figure&nbsp;<span>13.1</span></a> , except the vertical axis is log scale. The log scale makes it easier to see the differences in the PMFs for older outputs.</p>
<div class="page-columns page-full">
<div id="fig-decoy-distributions-top-1-3-log" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-decoy-distributions-top-1-3-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.3
</figcaption>
<div aria-describedby="fig-decoy-distributions-top-1-3-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/decoy-distributions-top-1-3-log.png" id="fig-decoy-distributions-top-1-3-log" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<p><a href="#fig-decoy-distributions-top-4-6-log" class="quarto-xref">Figure&nbsp;<span>13.4</span></a> is the same plot as <a href="#fig-decoy-distributions-top-4-6-not-log" class="quarto-xref">Figure&nbsp;<span>13.2</span></a> , except the vertical axis is log scale.</p>
<div class="page-columns page-full">
<div id="fig-decoy-distributions-top-4-6-log" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-decoy-distributions-top-4-6-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.4
</figcaption>
<div aria-describedby="fig-decoy-distributions-top-4-6-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/decoy-distributions-top-4-6-log.png" id="fig-decoy-distributions-top-4-6-log" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
</section>
<section id="attack-success-probability-by-output-age" class="level2 page-columns page-full" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="attack-success-probability-by-output-age"><span class="header-section-number">13.3</span> Attack success probability by output age</h2>
<p>The MAP decoder attack success probability varies with the age of the spent output. Where the decoy PMF is below the real spend PMF, the attack success probability is high. Where the decoy PMF is above the real spend PMF, the attack success probability is low. <a href="#fig-attack-success-top-1-3" class="quarto-xref">Figure&nbsp;<span>13.5</span></a> shows the attack success probability by output age for the top three fitted decoy distributions and the status quo decoy distribution.</p>
<p>There are four regions where the fitted decoy distributions do a poor job of protecting the real spend. The first occurs at about 10-20 seconds of age. As mentioned above, in practice outputs from zero to two minutes of age will be aggregated together, so this region is not of much concern.</p>
<p>The second region is 30 minutes to one hour. Notice that 20 minutes coincides with the “cliff” in the status quo decoy distribution that forms because the unspendable portion of the log-gamma distribution before the 10 block lock is redistributed to the early part of the spendable distribution. The 101-point resolution of the BJR estimator may have had a difficult time with this cliff in the decoy distribution because it is not smooth. The BJR estimator may be overestimating the thickness of the real spend distribution in this region. In other words, this region of high attack success may be a false reading.</p>
<p>The third region extends from the second day to the second week of age.</p>
<p>The fourth region occurs after one year of age. Notice that the log-GB2 and the log-GEV both have high attack success probability in this region, but the RPLN distribution does not. This example shows that the distribution family does affect the regions of the age distribution that would be most susceptible to the MAP Decoder attack, even when the average attack success probability, shown in <a href="#tbl-main-attack-success" class="quarto-xref">Table&nbsp;<span>13.1</span></a> , is similar between the distributions. Note also that the CDF shows that the share of rings spending outputs older than one year is very small.</p>
<div class="page-columns page-full">
<div id="fig-attack-success-top-1-3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-attack-success-top-1-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.5
</figcaption>
<div aria-describedby="fig-attack-success-top-1-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/attack-success-top-1-3.png" id="fig-attack-success-top-1-3" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<p><a href="#fig-attack-success-top-4-6" class="quarto-xref">Figure&nbsp;<span>13.6</span></a> shows the same data as <a href="#fig-attack-success-top-1-3" class="quarto-xref">Figure&nbsp;<span>13.5</span></a> , except for the top 4-6 fitted distributions.</p>
<div class="page-columns page-full">
<div id="fig-attack-success-top-4-6" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-attack-success-top-4-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.6
</figcaption>
<div aria-describedby="fig-attack-success-top-4-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/attack-success-top-4-6.png" id="fig-attack-success-top-4-6" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
</section>
<section id="attack-success-probability-for-different-λ-weights" class="level2 page-columns page-full" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="attack-success-probability-for-different-λ-weights"><span class="header-section-number">13.4</span> Attack success probability for different λ weights</h2>
<p>We also fitted decoy distributions with different λ weights in <a href="parametric-fit.html#eq-map-decoder-lambda" class="quarto-xref">Equation&nbsp;<span>12.2</span></a> . The mean attack success probability of these fitted distributions with λ = 0.5 in <a href="#tbl-lambda-attack-success" class="quarto-xref">Table&nbsp;<span>13.2</span></a> are higher than the λ = 1 fitted distributions, which is completely expected. The λ = 0.5 fitted distributions are optimizing to a different objective function, so the value of the λ = 1 objective function is not as good. However, the “loss” of the objective function is not very large, at around 0.2 percentage points for each of them.</p>
<div class="column-page">
<div id="tbl-lambda-attack-success" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lambda-attack-success-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.2: Attack success probability, λ = 1, 0.5
</figcaption>
<div aria-describedby="tbl-lambda-attack-success-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 3%">
<col style="width: 23%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Decoy distribution</th>
<th style="text-align: right;">λ</th>
<th style="text-align: right;">Attack success probability</th>
<th style="text-align: left;">Param 1</th>
<th style="text-align: left;">Param 2</th>
<th style="text-align: left;">Param 3</th>
<th style="text-align: left;">Param 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Log-GB2</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">7.590%</td>
<td style="text-align: left;">shape1 = 4.462</td>
<td style="text-align: left;">scale = 20.62</td>
<td style="text-align: left;">shape2 = 0.5553</td>
<td style="text-align: left;">shape3 = 7.957</td>
</tr>
<tr class="even">
<td style="text-align: left;">Log-GB2</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">7.783%</td>
<td style="text-align: left;">shape1 = 4.631</td>
<td style="text-align: left;">scale = 19.76</td>
<td style="text-align: left;">shape2 = 0.5308</td>
<td style="text-align: left;">shape3 = 6.235</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Log-GEV</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">7.730%</td>
<td style="text-align: left;">location = 8.382</td>
<td style="text-align: left;">scale = 3.851</td>
<td style="text-align: left;">shape = -0.3404</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Log-GEV</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">7.841%</td>
<td style="text-align: left;">location = 8.608</td>
<td style="text-align: left;">scale = 3.956</td>
<td style="text-align: left;">shape = -0.3369</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">RPLN</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">7.746%</td>
<td style="text-align: left;">shape2 = 6.684</td>
<td style="text-align: left;">meanlog = 9.725</td>
<td style="text-align: left;">sdlog = 3.964</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">RPLN</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">7.981%</td>
<td style="text-align: left;">shape2 = 6.121</td>
<td style="text-align: left;">meanlog = 9.977</td>
<td style="text-align: left;">sdlog = 4.064</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">GB2</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">7.794%</td>
<td style="text-align: left;">shape1 = 0.1282</td>
<td style="text-align: left;">scale = 4753</td>
<td style="text-align: left;">shape2 = 8.582</td>
<td style="text-align: left;">shape3 = 7.179</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GB2</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">7.984%</td>
<td style="text-align: left;">shape1 = 0.05374</td>
<td style="text-align: left;">scale = 8.369e+04</td>
<td style="text-align: left;">shape2 = 40.93</td>
<td style="text-align: left;">shape3 = 43.62</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Log-F</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">8.212%</td>
<td style="text-align: left;">df1 = 1.678</td>
<td style="text-align: left;">df2 = 9.067e+06</td>
<td style="text-align: left;">ncp = 17.06</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Log-F</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">8.463%</td>
<td style="text-align: left;">df1 = 1.563</td>
<td style="text-align: left;">df2 = 3.555e+07</td>
<td style="text-align: left;">ncp = 16.68</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Log-Gamma</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">8.470%</td>
<td style="text-align: left;">shape = 4.315</td>
<td style="text-align: left;">rate = 0.3751</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Log-Gamma</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">8.622%</td>
<td style="text-align: left;">shape = 4.517</td>
<td style="text-align: left;">rate = 0.3892</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Decoy status quo</td>
<td style="text-align: right;"></td>
<td style="text-align: right;">23.540%</td>
<td style="text-align: left;">shape = 19.28</td>
<td style="text-align: left;">rate = 1.61</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<p><a href="#fig-attack-success-lambda-decoy-log-gb2" class="quarto-xref">Figure&nbsp;<span>13.7</span></a> shows the attack success probability for the fitted GB2 decoy distributions when λ = 1 and λ = 0.5. One can see that the λ = 0.5 distribution more heavily weights the older outputs, as expected. That distribution has lower attack success probability against the older outputs than the λ = 1 distribution. Of course, the lower attack success probability there comes at the cost of having higher attack success probability against younger outputs.</p>
<p>Equivalent plots for the log-GEV and RPLN distribution are in <a href="#fig-attack-success-lambda-decoy-log-gev" class="quarto-xref">Figure&nbsp;<span>13.8</span></a> and <a href="#fig-attack-success-lambda-decoy-rpln" class="quarto-xref">Figure&nbsp;<span>13.9</span></a> .</p>
<div class="page-columns page-full">
<div id="fig-attack-success-lambda-decoy-log-gb2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-attack-success-lambda-decoy-log-gb2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.7
</figcaption>
<div aria-describedby="fig-attack-success-lambda-decoy-log-gb2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/attack-success-lambda-decoy-log-gb2.png" id="fig-attack-success-lambda-decoy-log-gb2" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<div class="page-columns page-full">
<div id="fig-attack-success-lambda-decoy-log-gev" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-attack-success-lambda-decoy-log-gev-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.8
</figcaption>
<div aria-describedby="fig-attack-success-lambda-decoy-log-gev-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/attack-success-lambda-decoy-log-gev.png" id="fig-attack-success-lambda-decoy-log-gev" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<div class="page-columns page-full">
<div id="fig-attack-success-lambda-decoy-rpln" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-attack-success-lambda-decoy-rpln-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.9
</figcaption>
<div aria-describedby="fig-attack-success-lambda-decoy-rpln-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/attack-success-lambda-decoy-rpln.png" id="fig-attack-success-lambda-decoy-rpln" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
</section>
<section id="code" class="level2 page-columns page-full" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="code"><span class="header-section-number">13.5</span> Code</h2>
<div class="cell column-page">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dRacula)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>threads <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Best to have one thread when do.sub.support == FALSE and when RAM is limited</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(future<span class="sc">::</span><span class="fu">multisession</span>(<span class="at">workers =</span> threads))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">future.globals.maxSize =</span> <span class="dv">8000</span><span class="sc">*</span><span class="dv">1024</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Some of this code could be re-factored to improve categorical selections.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>analysis.subset <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">sapply</span>(fit.results, <span class="at">FUN =</span> <span class="cf">function</span>(x) x<span class="sc">$</span>value))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>analysis.subset <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(analysis.subset, <span class="fu">which</span>(run.iters.simple<span class="sc">$</span>lambda <span class="sc">!=</span> <span class="dv">1</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove results where lambda does not equal 1</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>analysis.subset <span class="ot">&lt;-</span> analysis.subset[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Get top 6</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>analysis.subset.names <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"f_D."</span>, <span class="st">""</span>, <span class="fu">names</span>(run.iters.simple<span class="sc">$</span>f_D))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>analysis.subset.names <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(analysis.subset.names <span class="sc">==</span> <span class="st">"gamma"</span>, <span class="st">"Gamma"</span>, <span class="fu">toupper</span>(analysis.subset.names))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>analysis.subset.names[run.iters.simple<span class="sc">$</span>log.trans] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Log-"</span>, analysis.subset.names[run.iters.simple<span class="sc">$</span>log.trans])</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>analysis.subset.names <span class="ot">&lt;-</span> analysis.subset.names</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>low.lambda.subset <span class="ot">&lt;-</span> <span class="fu">which</span>(run.iters.simple<span class="sc">$</span>lambda <span class="sc">==</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    analysis.subset.names <span class="sc">%in%</span> analysis.subset.names[analysis.subset])</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>analysis.subset <span class="ot">&lt;-</span> <span class="fu">c</span>(analysis.subset, low.lambda.subset)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the lambda == 0.5 ones that correspond to the lambda == 1 "best" distributions</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>analysis.subset <span class="ot">&lt;-</span> <span class="fu">c</span>(analysis.subset, <span class="fu">nrow</span>(run.iters.simple) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>analysis.subset.names <span class="ot">&lt;-</span> <span class="fu">c</span>(analysis.subset.names, <span class="st">"Decoy status quo"</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Last one is status quo decoy</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>keep.time <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">date</span>()</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>performance.fit.results <span class="ot">&lt;-</span> future.apply<span class="sc">::</span><span class="fu">future_lapply</span>((<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(run.iters.simple)<span class="sc">+</span><span class="dv">1</span>))[analysis.subset], <span class="cf">function</span>(iter) {</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  GAMMA_SHAPE <span class="ot">=</span> <span class="fl">19.28</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  GAMMA_RATE <span class="ot">=</span> <span class="fl">1.61</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  G <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    actuar<span class="sc">::</span><span class="fu">plgamma</span>(x, <span class="at">shapelog =</span> GAMMA_SHAPE, <span class="at">ratelog =</span> GAMMA_RATE)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  G_star <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span> <span class="sc">&lt;=</span> x<span class="sc">*</span>v <span class="sc">&amp;</span> x<span class="sc">*</span>v <span class="sc">&lt;=</span> <span class="dv">1800</span>) <span class="sc">*</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">G</span>(x<span class="sc">*</span>v <span class="sc">+</span> <span class="dv">1200</span>) <span class="sc">-</span> <span class="fu">G</span>(<span class="dv">1200</span>) <span class="sc">+</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>          ( (x<span class="sc">*</span>v)<span class="sc">/</span>(<span class="dv">1800</span>) ) <span class="sc">*</span> <span class="fu">G</span>(<span class="dv">1200</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">/</span><span class="fu">G</span>(z<span class="sc">*</span>v) <span class="sc">+</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1800</span> <span class="sc">&lt;</span> x<span class="sc">*</span>v <span class="sc">&amp;</span> x<span class="sc">*</span>v <span class="sc">&lt;=</span> z<span class="sc">*</span>v) <span class="sc">*</span> <span class="fu">G</span>(x<span class="sc">*</span>v <span class="sc">+</span> <span class="dv">1200</span>)<span class="sc">/</span><span class="fu">G</span>(z<span class="sc">*</span>v) <span class="sc">+</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>      (z<span class="sc">*</span>v <span class="sc">&lt;</span> x<span class="sc">*</span>v) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  summary.performance <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">new.decoy =</span> <span class="dv">0</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  do.sub.support <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  do.current.decoy <span class="ot">&lt;-</span> iter <span class="sc">==</span> <span class="fu">nrow</span>(run.iters.simple) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  guess.prob.each.output <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, z)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  weekly.z.max <span class="ot">&lt;-</span> z</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> aggregate.real.spend.pmf</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  theta_i[theta_i <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (do.current.decoy) {</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="cn">FALSE</span>) {</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>      a_i <span class="ot">&lt;-</span> aggregate.real.spend.pmf</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      a_i <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">G_star</span>(<span class="fu">as.numeric</span>(<span class="dv">0</span><span class="sc">:</span>weekly.z.max)))</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    a_i[a_i <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (do.sub.support) {</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>      sub.supp <span class="ot">&lt;-</span> wrswoR<span class="sc">::</span><span class="fu">sample_int_expj</span>(<span class="fu">length</span>(theta_i), <span class="fu">ceiling</span>(<span class="fu">length</span>(theta_i)<span class="sc">/</span><span class="dv">10</span>), <span class="at">prob =</span> theta_i)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>      <span class="co"># start at 2 so G(x - 1) is not 0</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>      theta_i <span class="ot">&lt;-</span> theta_i[sub.supp]</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>      a_i <span class="ot">&lt;-</span> a_i[sub.supp]</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>      sub.supp <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(theta_i)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(theta_i) <span class="sc">==</span> <span class="fu">length</span>(a_i))</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    values.map.decoder.success.prob <span class="ot">&lt;-</span> <span class="fu">map.decoder.success.prob</span>(<span class="at">f_S =</span> theta_i<span class="sc">/</span><span class="fu">sum</span>(theta_i), <span class="at">f_D =</span> a_i<span class="sc">/</span><span class="fu">sum</span>(a_i))</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    guess.prob.each.output[sub.supp] <span class="ot">&lt;-</span> guess.prob.each.output[sub.supp] <span class="sc">+</span> values.map.decoder.success.prob</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    n.decoys <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    summary.performance[, new.decoy <span class="sc">:</span><span class="er">=</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>((theta_i<span class="sc">/</span><span class="fu">sum</span>(theta_i)) <span class="sc">*</span> (values.map.decoder.success.prob)<span class="sc">^</span>n.decoys)]</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    f_D.fun <span class="ot">&lt;-</span> run.iters.simple<span class="sc">$</span>f_D[[iter]]</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    fitted.par <span class="ot">&lt;-</span> fit.results[[iter]]<span class="sc">$</span>par</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    log.trans <span class="ot">&lt;-</span> run.iters.simple<span class="sc">$</span>log.trans[[iter]]</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (do.sub.support) {</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>      sub.supp <span class="ot">&lt;-</span> wrswoR<span class="sc">::</span><span class="fu">sample_int_expj</span>(<span class="fu">length</span>(theta_i), <span class="fu">ceiling</span>(<span class="fu">length</span>(theta_i)<span class="sc">/</span><span class="dv">10</span>), <span class="at">prob =</span> theta_i)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>      <span class="co"># start at 2 so G(x - 1) is not 0</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>      theta_i <span class="ot">&lt;-</span> theta_i[sub.supp]</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>      sub.supp <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(theta_i)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    f_D.return <span class="ot">&lt;-</span> <span class="fu">f_D.fun</span>(fitted.par, v, z, sub.supp, get.decoy.pmf, <span class="at">log.trans =</span> log.trans)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a_i &lt;- c(f_D.return$decoy.pmf, 0)</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    a_i <span class="ot">&lt;-</span> f_D.return<span class="sc">$</span>decoy.pmf</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(f_D.return)</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    a_i[a_i <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> .Machine<span class="sc">$</span>double.eps</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(theta_i) <span class="sc">==</span> <span class="fu">length</span>(a_i))</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    values.map.decoder.success.prob <span class="ot">&lt;-</span> <span class="fu">map.decoder.success.prob</span>(<span class="at">f_S =</span> theta_i<span class="sc">/</span><span class="fu">sum</span>(theta_i), <span class="at">f_D =</span> a_i<span class="sc">/</span><span class="fu">sum</span>(a_i))</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    guess.prob.each.output[sub.supp] <span class="ot">&lt;-</span> guess.prob.each.output[sub.supp] <span class="sc">+</span> values.map.decoder.success.prob</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(sub.supp)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    n.decoys <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    summary.performance[, new.decoy <span class="sc">:</span><span class="er">=</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>((theta_i<span class="sc">/</span><span class="fu">sum</span>(theta_i)) <span class="sc">*</span> (values.map.decoder.success.prob)<span class="sc">^</span>n.decoys)]</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note that this code originally iterated through multiple weeks. Some</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of the design decisions relect that history. </span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setnames</span>(summary.performance, <span class="st">"new.decoy"</span>,</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(do.current.decoy, <span class="st">"current.decoy"</span>, <span class="fu">names</span>(run.iters.simple<span class="sc">$</span>f_D)[iter]))</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary.performance =</span> summary.performance,</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">decoy.pmf =</span> a_i,</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">guess.prob.each.output =</span> guess.prob.each.output<span class="sc">/</span><span class="fu">nrow</span>(summary.performance))</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>}, <span class="at">future.globals =</span> <span class="fu">c</span>(<span class="st">"fit.results"</span>, <span class="st">"run.iters.simple"</span>, <span class="st">"aggregate.real.spend.pmf"</span>,</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  <span class="st">"map.decoder.success.prob"</span>, <span class="st">"get.decoy.pmf"</span>, <span class="st">"v"</span>, <span class="st">"z"</span>, <span class="st">"actuar::plgamma"</span>, <span class="st">"wrswoR::sample_int_expj"</span>),</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  <span class="at">future.packages =</span> <span class="st">"data.table"</span>, <span class="at">future.seed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(keep.time)</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">date</span>()</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(future<span class="sc">::</span>sequential)</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop workers to free RAM</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>extracted.params <span class="ot">&lt;-</span> <span class="fu">lapply</span>(analysis.subset[ <span class="sc">-</span> <span class="fu">length</span>(analysis.subset)], <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  <span class="co"># - length(analysis.subset) to remove the status quo decoy</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  deparsed <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">deparse</span>(run.iters.simple<span class="sc">$</span>f_D[[x]]), <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>  deparsed <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"(.* log.trans, *)|(, *tail.beyond.support.*)|(, lower.tail.*)"</span>, <span class="st">""</span>, deparsed)</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  deparsed <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" = [^ ]*"</span>, <span class="st">""</span>, deparsed)</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>  deparsed <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(deparsed, <span class="st">" "</span>)[[<span class="dv">1</span>]]</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>  deparsed <span class="ot">&lt;-</span> deparsed[deparsed <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(fit.results[[x]]<span class="sc">$</span>par)) {</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    param.value <span class="ot">&lt;-</span> param.trans[[<span class="fu">gsub</span>(<span class="st">"f_D."</span>, <span class="st">""</span>, <span class="fu">names</span>(run.iters.simple<span class="sc">$</span>f_D)[x])]][[i]](fit.results[[x]]<span class="sc">$</span>par[i])</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    deparsed[i] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(deparsed[i] , <span class="st">" = "</span>, <span class="fu">formatC</span>(param.value, <span class="at">width =</span> <span class="dv">5</span>))</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>  deparsed</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>GAMMA_SHAPE <span class="ot">=</span> <span class="fl">19.28</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>GAMMA_RATE <span class="ot">=</span> <span class="fl">1.61</span></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>extracted.params[[<span class="fu">length</span>(extracted.params) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"shape = "</span>, GAMMA_SHAPE), <span class="fu">paste0</span>(<span class="st">"rate = "</span>, GAMMA_RATE))</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>extracted.params <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">sapply</span>(extracted.params, <span class="st">"length&lt;-"</span>, <span class="fu">max</span>(<span class="fu">lengths</span>(extracted.params))))</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/15201305/how-to-convert-a-list-consisting-of-vector-of-different-lengths-to-a-usable-data</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(extracted.params) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Param "</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(extracted.params)))</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>n.decoys <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness <span class="ot">&lt;-</span> <span class="fu">sapply</span>(performance.fit.results, <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((aggregate.real.spend.pmf<span class="sc">/</span><span class="fu">sum</span>(aggregate.real.spend.pmf)) <span class="sc">*</span> (x<span class="sc">$</span>guess.prob.each.output)<span class="sc">^</span>n.decoys)</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist.name =</span> analysis.subset.names[analysis.subset],</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAP.decoder.effectiveness =</span> <span class="fu">formatC</span>(MAP.decoder.effectiveness, <span class="at">width =</span> <span class="dv">5</span>))</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness <span class="ot">&lt;-</span> <span class="fu">cbind</span>(MAP.decoder.effectiveness, extracted.params)</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(MAP.decoder.effectiveness, <span class="at">FUN =</span> <span class="cf">function</span>(x) {x[<span class="fu">is.na</span>(x)] <span class="ot">&lt;-</span> <span class="st">""</span>; x} ))</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MAP.decoder.effectiveness)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Decoy distribution"</span>, <span class="st">"Attack success probability"</span>)</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MAP.decoder.effectiveness) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[.]"</span>, <span class="st">" "</span>, <span class="fu">colnames</span>(MAP.decoder.effectiveness))</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">Attack success probability</span><span class="st">`</span> <span class="ot">&lt;-</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">as.numeric</span>(MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">Attack success probability</span><span class="st">`</span>))</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(MAP.decoder.effectiveness[ <span class="sc">!</span> analysis.subset <span class="sc">%in%</span> low.lambda.subset, ],</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"pipe"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">paste0</span>(<span class="st">"lr"</span>, <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">"l"</span>, <span class="fu">ncol</span>(extracted.params)), <span class="at">collapse =</span> <span class="st">""</span>)))</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">λ</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(analysis.subset <span class="sc">%in%</span> low.lambda.subset, <span class="fl">0.5</span>, <span class="dv">1</span>)</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">Decoy distribution</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">Decoy distribution</span><span class="st">`</span>,</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">Decoy distribution</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], <span class="st">"Decoy status quo"</span>)</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>MAP.decoder.effectiveness <span class="ot">&lt;-</span> MAP.decoder.effectiveness[, <span class="fu">c</span>(</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy distribution"</span>, <span class="st">"λ"</span>,  <span class="st">"Attack success probability"</span>,</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Param "</span>, <span class="fu">seq_len</span>(<span class="fu">ncol</span>(extracted.params))) ) ]</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(MAP.decoder.effectiveness[</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">order</span>(MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">Decoy distribution</span><span class="st">`</span>,  <span class="sc">-</span> MAP.decoder.effectiveness<span class="sc">$</span><span class="st">`</span><span class="at">λ</span><span class="st">`</span>), ],</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"pipe"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">paste0</span>(<span class="st">"lrr"</span>, <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">"l"</span>, <span class="fu">ncol</span>(extracted.params)), <span class="at">collapse =</span> <span class="st">""</span>)))</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>guess.prob.each.output <span class="ot">&lt;-</span> performance.fit.results[[<span class="dv">1</span>]]<span class="sc">$</span>guess.prob.each.output</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>display.x <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">floor</span>(<span class="fu">exp</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="fl">0.1</span>))))</span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>display.x <span class="ot">&lt;-</span> display.x[display.x <span class="sc">&lt;=</span> <span class="fu">length</span>(guess.prob.each.output)]</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>display.x <span class="ot">&lt;-</span> display.x[guess.prob.each.output[display.x] <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>decoy.plot.data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">setdiff</span>(analysis.subset, low.lambda.subset), <span class="cf">function</span>(x) {</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="fu">nrow</span>(run.iters.simple) <span class="sc">+</span> <span class="dv">1</span>) {</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> analysis.subset.names[x]</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    GAMMA_SHAPE <span class="ot">=</span> <span class="fl">19.28</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    GAMMA_RATE <span class="ot">=</span> <span class="fl">1.61</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    G <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>      actuar<span class="sc">::</span><span class="fu">plgamma</span>(x, <span class="at">shapelog =</span> GAMMA_SHAPE, <span class="at">ratelog =</span> GAMMA_RATE)</span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    G_star <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">0</span> <span class="sc">&lt;=</span> x<span class="sc">*</span>v <span class="sc">&amp;</span> x<span class="sc">*</span>v <span class="sc">&lt;=</span> <span class="dv">1800</span>) <span class="sc">*</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>        (<span class="fu">G</span>(x<span class="sc">*</span>v <span class="sc">+</span> <span class="dv">1200</span>) <span class="sc">-</span> <span class="fu">G</span>(<span class="dv">1200</span>) <span class="sc">+</span></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>            ( (x<span class="sc">*</span>v)<span class="sc">/</span>(<span class="dv">1800</span>) ) <span class="sc">*</span> <span class="fu">G</span>(<span class="dv">1200</span>)</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">/</span><span class="fu">G</span>(z<span class="sc">*</span>v) <span class="sc">+</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1800</span> <span class="sc">&lt;</span> x<span class="sc">*</span>v <span class="sc">&amp;</span> x<span class="sc">*</span>v <span class="sc">&lt;=</span> z<span class="sc">*</span>v) <span class="sc">*</span> <span class="fu">G</span>(x<span class="sc">*</span>v <span class="sc">+</span> <span class="dv">1200</span>)<span class="sc">/</span><span class="fu">G</span>(z<span class="sc">*</span>v) <span class="sc">+</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>        (z<span class="sc">*</span>v <span class="sc">&lt;</span> x<span class="sc">*</span>v) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    weekly.z.max <span class="ot">&lt;-</span> z</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    f_D.return <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">G_star</span>(<span class="fu">as.numeric</span>(<span class="dv">0</span><span class="sc">:</span>weekly.z.max)))[display.x]</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[x])</span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>    f_D.fun <span class="ot">&lt;-</span> run.iters.simple<span class="sc">$</span>f_D[[x]]</span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>    fitted.par <span class="ot">&lt;-</span> fit.results[[x]]<span class="sc">$</span>par</span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>    log.trans <span class="ot">&lt;-</span> run.iters.simple<span class="sc">$</span>log.trans[[x]]</span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>    f_D.return <span class="ot">&lt;-</span> <span class="fu">f_D.fun</span>(fitted.par, v, z, <span class="at">sub.supp =</span> display.x, get.decoy.pmf, <span class="at">log.trans =</span> log.trans)<span class="sc">$</span>decoy.pmf</span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(type, <span class="st">" "</span>, <span class="fu">which</span>(x <span class="sc">==</span> analysis.subset), <span class="st">" "</span>, x, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> display.x, <span class="at">y =</span> f_D.return, <span class="at">type =</span> type)</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>decoy.plot.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, decoy.plot.data),</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> display.x, <span class="at">y =</span> aggregate.real.spend.pmf[display.x], <span class="at">type =</span> <span class="st">"PMF real spend"</span>),</span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> display.x, <span class="at">y =</span> <span class="fu">cumsum</span>(aggregate.real.spend.pmf)[display.x], <span class="at">type =</span> <span class="st">"CDF real spend"</span>)</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>decoy.plot.data<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(decoy.plot.data<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CDF"</span>, <span class="st">"PMF"</span>)</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>decoy.plot.data<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">factor</span>(decoy.plot.data<span class="sc">$</span>panel, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PMF"</span>, <span class="st">"CDF"</span>))</span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>decoy.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(decoy.plot.data<span class="sc">$</span>type,</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, </span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(decoy.plot.data<span class="sc">$</span>type)[<span class="fu">grepl</span>(<span class="st">"Decoy"</span>, <span class="fu">unique</span>(decoy.plot.data<span class="sc">$</span>type))],</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CDF real spend"</span>))</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/decoy-distributions-top-1-3-not-log.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(decoy.plot.data[decoy.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>, <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[analysis.subset][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])), ],</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"PMF comparison: Top 3 Improved Decoy Distributions"</span>,</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_continuous</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/decoy-distributions-top-4-6-not-log.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(decoy.plot.data[decoy.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>, <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[analysis.subset][<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])), ],</span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"PMF comparison: Top 4-6 Improved Decoy Distributions"</span>,</span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_continuous</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/decoy-distributions-top-1-3-log.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(decoy.plot.data[decoy.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>, <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[analysis.subset][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])), ],</span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"PMF comparison: Top 3 Improved Decoy Distributions (Log Vertical Scale)"</span>,</span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability (Top: log scale. Bottom: normal scale.)"</span>,</span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_log10</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/decoy-distributions-top-4-6-log.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(decoy.plot.data[decoy.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>, <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[analysis.subset][<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])), ],</span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"PMF comparison: Top 4-6 Improved Decoy Distributions (Log Vertical Scale)"</span>,</span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability (Top: log scale. Bottom: normal scale.)"</span>,</span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_log10</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a><span class="co"># Attack success probability</span></span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">setdiff</span>(analysis.subset, low.lambda.subset), <span class="cf">function</span>(x) {</span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="fu">nrow</span>(run.iters.simple) <span class="sc">+</span> <span class="dv">1</span>) {</span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> <span class="st">"Decoy status quo"</span></span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[x])</span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(type, <span class="st">" "</span>, <span class="fu">which</span>(x <span class="sc">==</span> analysis.subset), <span class="st">" "</span>, x, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a>  guess.prob.each.output <span class="ot">&lt;-</span> performance.fit.results[[<span class="fu">which</span>(x <span class="sc">==</span> analysis.subset)]]<span class="sc">$</span>guess.prob.each.output</span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>  n.decoys <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> display.x, <span class="at">y =</span> guess.prob.each.output[display.x]<span class="sc">^</span>n.decoys, <span class="at">type =</span> type)</span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, MAP.decoder.plot.data),</span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> display.x, <span class="at">y =</span> <span class="fu">cumsum</span>(aggregate.real.spend.pmf)[display.x], <span class="at">type =</span> <span class="st">"CDF real spend"</span>)</span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"f_D."</span>, <span class="st">"Decoy "</span>, MAP.decoder.plot.data<span class="sc">$</span>type)</span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CDF"</span>, <span class="st">"MAP decoder attack success probability"</span>)</span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">factor</span>(MAP.decoder.plot.data<span class="sc">$</span>panel,</span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAP decoder attack success probability"</span>, <span class="st">"CDF"</span>))</span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(MAP.decoder.plot.data<span class="sc">$</span>type,</span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, </span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type)[<span class="fu">grepl</span>(<span class="st">"Decoy"</span>, <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type))],</span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CDF real spend"</span>))</span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/attack-success-top-1-3.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MAP.decoder.plot.data[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>, <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[analysis.subset][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])), ],</span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Attack Success Comparison: Top 3 Improved Decoy Distributions"</span>,</span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_continuous</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/attack-success-top-4-6.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MAP.decoder.plot.data[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>, <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[analysis.subset][<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])), ],</span>
<span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="st">"Attack Success Comparison: Top 4-6 Improved Decoy Distributions"</span>,</span>
<span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-536"><a href="#cb1-536" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-537"><a href="#cb1-537" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-538"><a href="#cb1-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-539"><a href="#cb1-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-540"><a href="#cb1-540" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_continuous</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-541"><a href="#cb1-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-542"><a href="#cb1-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-543"><a href="#cb1-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-544"><a href="#cb1-544" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-545"><a href="#cb1-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-546"><a href="#cb1-546" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-547"><a href="#cb1-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-548"><a href="#cb1-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-549"><a href="#cb1-549" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-550"><a href="#cb1-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-551"><a href="#cb1-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-552"><a href="#cb1-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-553"><a href="#cb1-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-554"><a href="#cb1-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-555"><a href="#cb1-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-556"><a href="#cb1-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-557"><a href="#cb1-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-558"><a href="#cb1-558" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare different lambdas</span></span>
<span id="cb1-559"><a href="#cb1-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-560"><a href="#cb1-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-561"><a href="#cb1-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-562"><a href="#cb1-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-563"><a href="#cb1-563" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(analysis.subset, <span class="cf">function</span>(x) {</span>
<span id="cb1-564"><a href="#cb1-564" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="fu">nrow</span>(run.iters.simple) <span class="sc">+</span> <span class="dv">1</span>) {</span>
<span id="cb1-565"><a href="#cb1-565" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> <span class="st">"Decoy status quo"</span></span>
<span id="cb1-566"><a href="#cb1-566" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-567"><a href="#cb1-567" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Decoy "</span>, analysis.subset.names[x])</span>
<span id="cb1-568"><a href="#cb1-568" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-569"><a href="#cb1-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(type, <span class="st">" "</span>, <span class="fu">which</span>(x <span class="sc">==</span> analysis.subset), <span class="st">" "</span>, x, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-570"><a href="#cb1-570" aria-hidden="true" tabindex="-1"></a>  guess.prob.each.output <span class="ot">&lt;-</span> performance.fit.results[[<span class="fu">which</span>(x <span class="sc">==</span> analysis.subset)]]<span class="sc">$</span>guess.prob.each.output</span>
<span id="cb1-571"><a href="#cb1-571" aria-hidden="true" tabindex="-1"></a>  n.decoys <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb1-572"><a href="#cb1-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> display.x, <span class="at">y =</span> guess.prob.each.output[display.x]<span class="sc">^</span>n.decoys,</span>
<span id="cb1-573"><a href="#cb1-573" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> type, <span class="at">lambda =</span> run.iters.simple<span class="sc">$</span>lambda[x])</span>
<span id="cb1-574"><a href="#cb1-574" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-575"><a href="#cb1-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-576"><a href="#cb1-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-577"><a href="#cb1-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-578"><a href="#cb1-578" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb1-579"><a href="#cb1-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, MAP.decoder.plot.data),</span>
<span id="cb1-580"><a href="#cb1-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">x =</span> display.x, <span class="at">y =</span> <span class="fu">cumsum</span>(aggregate.real.spend.pmf)[display.x],</span>
<span id="cb1-581"><a href="#cb1-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"CDF real spend"</span>, <span class="at">lambda =</span> <span class="dv">1</span>)</span>
<span id="cb1-582"><a href="#cb1-582" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-583"><a href="#cb1-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-584"><a href="#cb1-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-585"><a href="#cb1-585" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"f_D."</span>, <span class="st">"Decoy "</span>, MAP.decoder.plot.data<span class="sc">$</span>type)</span>
<span id="cb1-586"><a href="#cb1-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-587"><a href="#cb1-587" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type.reserved <span class="ot">&lt;-</span> MAP.decoder.plot.data<span class="sc">$</span>type</span>
<span id="cb1-588"><a href="#cb1-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-589"><a href="#cb1-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-590"><a href="#cb1-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-591"><a href="#cb1-591" aria-hidden="true" tabindex="-1"></a><span class="co"># Start specific distributions</span></span>
<span id="cb1-592"><a href="#cb1-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-593"><a href="#cb1-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-594"><a href="#cb1-594" aria-hidden="true" tabindex="-1"></a>lambda.distribution <span class="ot">&lt;-</span> <span class="st">"Decoy Log-GB2"</span></span>
<span id="cb1-595"><a href="#cb1-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-596"><a href="#cb1-596" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> lambda.distribution] <span class="ot">&lt;-</span> </span>
<span id="cb1-597"><a href="#cb1-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(lambda.distribution, <span class="st">", lambda = "</span>, </span>
<span id="cb1-598"><a href="#cb1-598" aria-hidden="true" tabindex="-1"></a>    MAP.decoder.plot.data<span class="sc">$</span>lambda[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> lambda.distribution])</span>
<span id="cb1-599"><a href="#cb1-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-600"><a href="#cb1-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-601"><a href="#cb1-601" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-602"><a href="#cb1-602" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CDF"</span>, <span class="st">"MAP decoder attack success probability"</span>)</span>
<span id="cb1-603"><a href="#cb1-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-604"><a href="#cb1-604" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">factor</span>(MAP.decoder.plot.data<span class="sc">$</span>panel,</span>
<span id="cb1-605"><a href="#cb1-605" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"MAP decoder attack success probability"</span>, <span class="st">"CDF"</span>))</span>
<span id="cb1-606"><a href="#cb1-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-607"><a href="#cb1-607" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(MAP.decoder.plot.data<span class="sc">$</span>type,</span>
<span id="cb1-608"><a href="#cb1-608" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, </span>
<span id="cb1-609"><a href="#cb1-609" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type)[<span class="fu">grepl</span>(<span class="st">"Decoy"</span>, <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type))],</span>
<span id="cb1-610"><a href="#cb1-610" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CDF real spend"</span>))</span>
<span id="cb1-611"><a href="#cb1-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-612"><a href="#cb1-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-613"><a href="#cb1-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-614"><a href="#cb1-614" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">"images/attack-success-lambda-"</span>, <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"-"</span>, lambda.distribution)), <span class="st">".png"</span>),</span>
<span id="cb1-615"><a href="#cb1-615" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-616"><a href="#cb1-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-617"><a href="#cb1-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-618"><a href="#cb1-618" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MAP.decoder.plot.data[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-619"><a href="#cb1-619" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>) <span class="sc">|</span> <span class="fu">grepl</span>(lambda.distribution, MAP.decoder.plot.data<span class="sc">$</span>type), ],</span>
<span id="cb1-620"><a href="#cb1-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-621"><a href="#cb1-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Attack Success Comparison with Different Lambdas: "</span>, lambda.distribution),</span>
<span id="cb1-622"><a href="#cb1-622" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb1-623"><a href="#cb1-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-624"><a href="#cb1-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-625"><a href="#cb1-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-626"><a href="#cb1-626" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_continuous</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-637"><a href="#cb1-637" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-638"><a href="#cb1-638" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-639"><a href="#cb1-639" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-640"><a href="#cb1-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-641"><a href="#cb1-641" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-642"><a href="#cb1-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-643"><a href="#cb1-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-644"><a href="#cb1-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-645"><a href="#cb1-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-646"><a href="#cb1-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-647"><a href="#cb1-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-648"><a href="#cb1-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-649"><a href="#cb1-649" aria-hidden="true" tabindex="-1"></a>lambda.distribution <span class="ot">&lt;-</span> <span class="st">"Decoy Log-GEV"</span></span>
<span id="cb1-650"><a href="#cb1-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-651"><a href="#cb1-651" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> MAP.decoder.plot.data<span class="sc">$</span>type.reserved</span>
<span id="cb1-652"><a href="#cb1-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-653"><a href="#cb1-653" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> lambda.distribution] <span class="ot">&lt;-</span> </span>
<span id="cb1-654"><a href="#cb1-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(lambda.distribution, <span class="st">", lambda = "</span>, </span>
<span id="cb1-655"><a href="#cb1-655" aria-hidden="true" tabindex="-1"></a>    MAP.decoder.plot.data<span class="sc">$</span>lambda[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> lambda.distribution])</span>
<span id="cb1-656"><a href="#cb1-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-657"><a href="#cb1-657" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(MAP.decoder.plot.data<span class="sc">$</span>type,</span>
<span id="cb1-658"><a href="#cb1-658" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, </span>
<span id="cb1-659"><a href="#cb1-659" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type)[<span class="fu">grepl</span>(<span class="st">"Decoy"</span>, <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type))],</span>
<span id="cb1-660"><a href="#cb1-660" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CDF real spend"</span>))</span>
<span id="cb1-661"><a href="#cb1-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-662"><a href="#cb1-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-663"><a href="#cb1-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-664"><a href="#cb1-664" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">"images/attack-success-lambda-"</span>, <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"-"</span>, lambda.distribution)), <span class="st">".png"</span>),</span>
<span id="cb1-665"><a href="#cb1-665" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-666"><a href="#cb1-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-667"><a href="#cb1-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-668"><a href="#cb1-668" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MAP.decoder.plot.data[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-669"><a href="#cb1-669" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>) <span class="sc">|</span> <span class="fu">grepl</span>(lambda.distribution, MAP.decoder.plot.data<span class="sc">$</span>type), ],</span>
<span id="cb1-670"><a href="#cb1-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-671"><a href="#cb1-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Attack Success Comparison with Different Lambdas: "</span>, lambda.distribution),</span>
<span id="cb1-672"><a href="#cb1-672" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb1-673"><a href="#cb1-673" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-674"><a href="#cb1-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-675"><a href="#cb1-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-676"><a href="#cb1-676" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-677"><a href="#cb1-677" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-678"><a href="#cb1-678" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-679"><a href="#cb1-679" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-680"><a href="#cb1-680" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-681"><a href="#cb1-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-682"><a href="#cb1-682" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-683"><a href="#cb1-683" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_continuous</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-684"><a href="#cb1-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-685"><a href="#cb1-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-686"><a href="#cb1-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-687"><a href="#cb1-687" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-688"><a href="#cb1-688" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-689"><a href="#cb1-689" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-690"><a href="#cb1-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-691"><a href="#cb1-691" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-692"><a href="#cb1-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-693"><a href="#cb1-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-694"><a href="#cb1-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-695"><a href="#cb1-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-696"><a href="#cb1-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-697"><a href="#cb1-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-698"><a href="#cb1-698" aria-hidden="true" tabindex="-1"></a>lambda.distribution <span class="ot">&lt;-</span> <span class="st">"Decoy RPLN"</span></span>
<span id="cb1-699"><a href="#cb1-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-700"><a href="#cb1-700" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> MAP.decoder.plot.data<span class="sc">$</span>type.reserved</span>
<span id="cb1-701"><a href="#cb1-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-702"><a href="#cb1-702" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> lambda.distribution] <span class="ot">&lt;-</span> </span>
<span id="cb1-703"><a href="#cb1-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(lambda.distribution, <span class="st">", lambda = "</span>, </span>
<span id="cb1-704"><a href="#cb1-704" aria-hidden="true" tabindex="-1"></a>    MAP.decoder.plot.data<span class="sc">$</span>lambda[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">==</span> lambda.distribution])</span>
<span id="cb1-705"><a href="#cb1-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-706"><a href="#cb1-706" aria-hidden="true" tabindex="-1"></a>MAP.decoder.plot.data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(MAP.decoder.plot.data<span class="sc">$</span>type,</span>
<span id="cb1-707"><a href="#cb1-707" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, </span>
<span id="cb1-708"><a href="#cb1-708" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type)[<span class="fu">grepl</span>(<span class="st">"Decoy"</span>, <span class="fu">unique</span>(MAP.decoder.plot.data<span class="sc">$</span>type))],</span>
<span id="cb1-709"><a href="#cb1-709" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CDF real spend"</span>))</span>
<span id="cb1-710"><a href="#cb1-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-711"><a href="#cb1-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-712"><a href="#cb1-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-713"><a href="#cb1-713" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">"images/attack-success-lambda-"</span>, <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"-"</span>, lambda.distribution)), <span class="st">".png"</span>),</span>
<span id="cb1-714"><a href="#cb1-714" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-715"><a href="#cb1-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-716"><a href="#cb1-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-717"><a href="#cb1-717" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(MAP.decoder.plot.data[MAP.decoder.plot.data<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PMF real spend"</span>, <span class="st">"CDF real spend"</span>,</span>
<span id="cb1-718"><a href="#cb1-718" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decoy status quo"</span>) <span class="sc">|</span> <span class="fu">grepl</span>(lambda.distribution, MAP.decoder.plot.data<span class="sc">$</span>type), ],</span>
<span id="cb1-719"><a href="#cb1-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> type)) <span class="sc">+</span></span>
<span id="cb1-720"><a href="#cb1-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Attack Success Comparison with Different Lambdas: "</span>, lambda.distribution),</span>
<span id="cb1-721"><a href="#cb1-721" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb1-722"><a href="#cb1-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-723"><a href="#cb1-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-724"><a href="#cb1-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-725"><a href="#cb1-725" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-726"><a href="#cb1-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span>v, <span class="dv">10</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span><span class="sc">/</span>v, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span><span class="sc">/</span>v),</span>
<span id="cb1-727"><a href="#cb1-727" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hr"</span>, <span class="st">"12 hr"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-728"><a href="#cb1-728" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-729"><a href="#cb1-729" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="at">facets =</span> <span class="fu">vars</span>(panel), <span class="at">design =</span> <span class="st">"A</span><span class="sc">\n</span><span class="st">B"</span>, <span class="at">scale =</span> <span class="st">"free_y"</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-730"><a href="#cb1-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linewidth =</span> <span class="st">"none"</span>, <span class="at">linetype =</span> <span class="st">"none"</span>,</span>
<span id="cb1-731"><a href="#cb1-731" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb1-732"><a href="#cb1-732" aria-hidden="true" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facetted_pos_scales</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">scale_y_continuous</span>(), <span class="fu">scale_y_continuous</span>())) <span class="sc">+</span></span>
<span id="cb1-733"><a href="#cb1-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-734"><a href="#cb1-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-735"><a href="#cb1-735" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-736"><a href="#cb1-736" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-737"><a href="#cb1-737" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span>
<span id="cb1-738"><a href="#cb1-738" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-739"><a href="#cb1-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-740"><a href="#cb1-740" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./parametric-fit.html" class="pagination-link" aria-label="Parametric Fit">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Parametric Fit</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./appendix-bjr-benchmarks.html" class="pagination-link" aria-label="Appendix: BJR Benchmarks">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Appendix: BJR Benchmarks</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>