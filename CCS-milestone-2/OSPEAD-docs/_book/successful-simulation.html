<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Successful Simulation – OSPEAD-docs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ring-gathering.html" rel="next">
<link href="./requirements.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-81b089a3b74ed4cf194f083418e7130b.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a0d8cd41196b3779e6040b3024b155.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./successful-simulation.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Successful Simulation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">OSPEAD-docs</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./requirements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Requirements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./successful-simulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Successful Simulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ring-gathering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ring Gathering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonstandard-transactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Nonstandard Transactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./broadcast-time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Broadcast Time</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./miscellaneous-preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Miscellaneous Preparation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformed-age.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Transformed Age</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bjr-and-patra-sen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">BJR and Patra-Sen</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonparametric-real-spend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Nonparametric Real Spend</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./real-spend-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Real Spend Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parametric-fit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Parametric Fit</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./performance-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Performance Evaluation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-bjr-benchmarks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Appendix: BJR Benchmarks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-generation" id="toc-data-generation" class="nav-link active" data-scroll-target="#data-generation"><span class="header-section-number">3.1</span> Data generation</a></li>
  <li><a href="#sec-bjr-explanation" id="toc-sec-bjr-explanation" class="nav-link" data-scroll-target="#sec-bjr-explanation"><span class="header-section-number">3.2</span> First step: Separate the <code>wallet2</code> ring distribution from nonstandard rings</a></li>
  <li><a href="#sec-patra-sen-explanation" id="toc-sec-patra-sen-explanation" class="nav-link" data-scroll-target="#sec-patra-sen-explanation"><span class="header-section-number">3.3</span> Second step: Separate the real spend distribution from the <code>wallet2</code> decoy distribution</a></li>
  <li><a href="#simulation-results" id="toc-simulation-results" class="nav-link" data-scroll-target="#simulation-results"><span class="header-section-number">3.4</span> Simulation results</a>
  <ul class="collapse">
  <li><a href="#mixing-proportions" id="toc-mixing-proportions" class="nav-link" data-scroll-target="#mixing-proportions"><span class="header-section-number">3.4.1</span> Mixing proportions</a></li>
  <li><a href="#kolmogorovsmirnov-statistic" id="toc-kolmogorovsmirnov-statistic" class="nav-link" data-scroll-target="#kolmogorovsmirnov-statistic"><span class="header-section-number">3.4.2</span> Kolmogorov–Smirnov statistic</a></li>
  <li><a href="#plots" id="toc-plots" class="nav-link" data-scroll-target="#plots"><span class="header-section-number">3.4.3</span> Plots</a></li>
  </ul></li>
  <li><a href="#is-the-bjr-estimator-necessary" id="toc-is-the-bjr-estimator-necessary" class="nav-link" data-scroll-target="#is-the-bjr-estimator-necessary"><span class="header-section-number">3.5</span> Is the BJR estimator necessary?</a></li>
  <li><a href="#sec-successful-simulation-code" id="toc-sec-successful-simulation-code" class="nav-link" data-scroll-target="#sec-successful-simulation-code"><span class="header-section-number">3.6</span> Code</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-successful-simulation" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Successful Simulation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This chapter walks through a realistic simulation that successfully recovers the real spend age distribution of Litecoin (LTC) outputs. Rings are randomly generated as follows:</p>
<ol type="1">
<li><p>One real spend ring member is drawn from the empirical LTC distribution of <a href="https://en.wikipedia.org/wiki/ISO_week_date">ISO week</a> 2022-10.</p></li>
<li><p>Fifteen decoys are drawn from the distribution that Monero’s “standard” <code>wallet2</code> decoy selection algorithm uses.</p></li>
<li><p>A small number of “nonstandard” rings are generated from a log-triangular and a uniform decoy distribution. These rings are added to the dataset with the “standard” rings.</p></li>
</ol>
<p>Applying OSPEAD techniques to the simulated ring dataset, the empirical LTC distribution of ISO week 2022-10 can be recovered. The successful estimation demonstrates that OSPEAD can recover a realistic real spend distribution from 16-member rings even in the presence of nonstandard rings.</p>
<section id="data-generation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-generation"><span class="header-section-number">3.1</span> Data generation</h2>
<p>First, the real spend age distribution of LTC is computed. This is done for the 5th, 10th, and 15th ISO week in 2022 using <a href="https://github.com/Rucknium/OSPEAD/tree/main/General-Blockchain-Age-of-Spent-Outputs">this code</a>.</p>
<p>Next, decoy distributions are needed. The main decoy distribution is the same as Monero’s <code>wallet2</code> distribution: a log-gamma distribution with shape parameter 19.28 and rate parameter 1.61, plus a few Monero-specific adjustments. Two other decoy distributions are needed to represent nonstandard decoy selection algorithms that “third-party” Monero wallet developers may be using.</p>
<p>A uniform distribution, where all outputs are equally likely to be chosen, is a naive distribution that a third-party wallet developer could plausibly use. In fact, a uniform distribution was used by the standard Monero wallet in the initial months of the blockchain <span class="citation" data-cites="Noether2014">(<a href="references.html#ref-Noether2014" role="doc-biblioref">Noether, Noether, and Mackenzie 2014</a>)</span>. The second nonstandard distribution will be a log-triangular distribution, another distribution that a third-party wallet developer could plausibly use. For a period of time, the standard Monero wallet <a href="https://github.com/monero-project/monero/pull/255">used a triangular distribution</a>.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Knowledge of the nonstandard decoy distributions is not needed for OSPEAD. In the statistical estimation, these distributions are treated as unknown. The only decoy distribution that needs to be known is the standard <code>wallet2</code> distribution, which we know because it is in Monero’s open source code.</p>
</div>
</div>
<p>For the simulation, 300,000 rings are produced. This is approximately the number of rings that appear on the Monero blockchain in a typical week. (Note that a single transaction may have many rings.)</p>
<p>Three types of rings are produced:</p>
<ol type="A">
<li><p>Rings where one ring member is drawn from the empirical LTC distribution of ISO week 2022-10 and the remaining 15 rings members are drawn from the <code>wallet2</code> log-gamma distribution. 93 percent of rings in the dataset are of this type.</p></li>
<li><p>Rings where one ring member is drawn from the empirical LTC distribution of ISO week 2022-05 and the remaining 15 rings members are drawn from a log-triangular distribution with minimum one second, maximum one year, and mode one week. 5 percent of rings in the dataset are of this type.</p></li>
<li><p>Rings where one ring member is drawn from the empirical LTC distribution of ISO week 2022-15 and the remaining 15 rings members are drawn from the a uniform distribution with minimum one second and maximum one year. 2 percent of rings in the dataset are of this type.</p></li>
</ol>
<p>Notice that we use LTC distributions from different weeks. This shows that OSPEAD works even when users using the nonstandard wallet implementations do not follow the same spent output age distribution as users who use the standard <code>wallet2</code> distribution.</p>
<p>To generate random numbers from the uniform and log-triangular distribution, the corresponding R functions (<code>runif()</code> and <code>triangle::rltriangle()</code>) are used. Random draws from the <code>wallet2</code> decoy distribution and the LTC empirical distributions are accomplished by using a standard technique in probability computing. The cumulative distribution function (CDF) of each of these distributions are computed. Then, the CDFs are inverted by numerical methods to obtain the CDF inverse, also known as the quantile function. (Using numerical instead of analytical methods causes a tolerable slowdown in random number generation.) Uniform(0, 1) random numbers are transformed by the inverted CDFs to obtain random numbers with the desired distribution.</p>
</section>
<section id="sec-bjr-explanation" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-bjr-explanation"><span class="header-section-number">3.2</span> First step: Separate the <code>wallet2</code> ring distribution from nonstandard rings</h2>
<p>Distribution component “A”, associated with transactions created by <code>wallet2</code>, makes up 93 percent of the rings in the simulated dataset. Transactions created by <code>wallet2</code> also make up the majority of transactions on the Monero blockchain. Analysis focuses on this component “A” because most transactions are in it, but also because the second step requires knowledge of the decoy selection distribution, which is known for transactions created by <code>wallet2</code>, but not necessarily known for transactions created by “third-party” wallet implementations.</p>
<p>The CDF of component “A” must be estimated. I use an estimator developed by <span class="citation" data-cites="Bonhomme2016">Bonhomme, Jochmans, and Robin (<a href="references.html#ref-Bonhomme2016" role="doc-biblioref">2016</a>)</span> to accomplish the task. The BJR estimator requires the analyst to specify <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>, the number of distribution components in the dataset. In this simulation, I will set <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> to 4, which is one more than the true number of components. I intentionally overshoot the true <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> to demonstrate the performance of the estimator when the true <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> is not exactly known.</p>
<p>The BJR estimator should take a few hours to run with the default number of threads.</p>
</section>
<section id="sec-patra-sen-explanation" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-patra-sen-explanation"><span class="header-section-number">3.3</span> Second step: Separate the real spend distribution from the <code>wallet2</code> decoy distribution</h2>
<p>Let <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{A}(x)</annotation></semantics></math> be CDF of distribution component “A”, which is a <a href="https://en.wikipedia.org/wiki/Mixture_distribution">mixture distribution</a> of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>1</mn><mn>16</mn></mfrac><annotation encoding="application/x-tex">\frac{1}{16}</annotation></semantics></math> parts real spend distribution <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{A,S}(x)</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mn>15</mn><mn>16</mn></mfrac><annotation encoding="application/x-tex">\frac{15}{16}</annotation></semantics></math> parts <code>wallet2</code> decoy distribution <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>D</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{A,D}(x)</annotation></semantics></math>. The CDF of component “A” can be decomposed:</p>
<p><span id="eq-mixture"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mn>16</mn></mfrac><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mfrac><mn>15</mn><mn>16</mn></mfrac><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>D</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>3.1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
F_{A}(x)=\frac{1}{16}F_{A,S}(x)+\frac{15}{16}F_{A,D}(x)
 \qquad(3.1)</annotation></semantics></math></span></p>
<p>The BJR estimator in the first step produced an estimate of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{A}(x)</annotation></semantics></math>. The <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>D</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{A,D}(x)</annotation></semantics></math> CDF is known because it is the distribution produced by Monero’s open source decoy selection algorithm in <code>wallet2</code>. <a href="#eq-mixture" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> can be easily solved for the real spend distribution <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{A,S}(x)</annotation></semantics></math> because it is one equation in one unknown:</p>
<p><span id="eq-mixture-inversion"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>16</mn><msub><mi>F</mi><mi>A</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>15</mn><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>D</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>3.2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
F_{A,S}(x)=16F_{A}(x)-15F_{A,D}(x)
 \qquad(3.2)</annotation></semantics></math></span></p>
<p><a href="#eq-mixture-inversion" class="quarto-xref">Equation&nbsp;<span>3.2</span></a> can be computed simply, but a valid CDF might not be produced because of sampling variation. <span class="citation" data-cites="Patra2016">Patra and Sen (<a href="references.html#ref-Patra2016" role="doc-biblioref">2016</a>)</span> provides a method for adjusting the computed <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_{A,S}(x)</annotation></semantics></math> to a valid CDF (i.e.&nbsp;weakly monotonically increasing and satisfying <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>lim</mo><mrow><mi>x</mi><mo>→</mo><mi>−</mi><mi>∞</mi></mrow></munder><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\underset{x\rightarrow-\infty}{\lim}F_{A,S}(x)=0</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>lim</mo><mrow><mi>x</mi><mo>→</mo><mi>∞</mi></mrow></munder><msub><mi>F</mi><mrow><mi>A</mi><mo>,</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\underset{x\rightarrow\infty}{\lim}F_{A,S}(x)=1</annotation></semantics></math>).</p>
</section>
<section id="simulation-results" class="level2 page-columns page-full" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="simulation-results"><span class="header-section-number">3.4</span> Simulation results</h2>
<p>After running the code in <a href="#sec-successful-simulation-code" class="quarto-xref"><span>Section 3.6</span></a>, we get the following results.</p>
<section id="mixing-proportions" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="mixing-proportions"><span class="header-section-number">3.4.1</span> Mixing proportions</h3>
<p>The mixing proportions are the share of each distribution component (A, B, C) in the dataset. Above, we set these values in the simulation to 0.93, 0.05, and 0.02, respectively. The BJR estimator can produce an estimate of these mixing proportions, based on the simulated dataset. The exact values of these estimates are not very important for OSPEAD, except that the greatest value is assumed to correspond to the <code>wallet2</code>-associated distribution component. Also, these results establish context for the mixing proportions results from the real Monero dataset.</p>
<p>The estimated mixing proportions are: <code>0.8898, 0.0478, 0.0191, -0.0441</code></p>
<p>Notice that the estimates are not constrained to add to 1, nor do the individual mixing proportion estimates necessarily fall between 0 and 1. What we see here is general agreement of these estimates with the mixing proportions set in the simulation parameters. The “phantom” fourth distribution component, which does not actually exist in the dataset, is estimated to have a “negative” mixing proportion.</p>
</section>
<section id="kolmogorovsmirnov-statistic" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="kolmogorovsmirnov-statistic"><span class="header-section-number">3.4.2</span> Kolmogorov–Smirnov statistic</h3>
<p>We want to know how close our estimate was to the actual LTC real spend distribution. In the next section we will view some plots, but first we will compute a numeric metric of distribution “closeness”.</p>
<p>The Kolmogorov–Smirnov (KS) statistic is a common way to measure the difference between two distributions. The KS statistic is the maximum vertical distance between two CDFs. Its minimum possible value is 0 and its maximum possible value is 1. <a href="#fig-ks-statistic" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> shows a visual of the KS statistic.</p>
<p>The KS statistic between the estimated and actual LTC real spend distribution is 0.0522.</p>
<!-- This sets the transparent color of the next image to white so it stands out in dark mode -->
<style>
img {
  background-color: white;
}
</style>
<div id="fig-ks-statistic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-ks-statistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: KS Statistic. Source: <a href="https://upload.wikimedia.org/wikipedia/commons/3/3f/KS2_Example.png">Wikipedia</a>.
</figcaption>
<div aria-describedby="fig-ks-statistic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/KS2_Example.png" class="img-fluid figure-img">
</div>
</figure>
</div>
</section>
<section id="plots" class="level3 page-columns page-full" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="plots"><span class="header-section-number">3.4.3</span> Plots</h3>
<p>At last, we will view plots that show how accurate our estimate is. <a href="#fig-ltc-simulation-cdf" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> shows:</p>
<ol type="1">
<li><p>In green, the CDF of the real spend distribution we are trying to estimate.</p></li>
<li><p>In blue, the OSPEAD estimate of the green line.</p></li>
<li><p>In violet, the decoy selection distribution of <code>wallet2</code>.</p></li>
<li><p>In pink, the ring distribution of the first “unknown” decoy distribution (i.e.&nbsp;the log-triangular distribution) combined with the LTC real spend distribution of ISO week 2022-05.</p></li>
<li><p>In red, the ring distribution of the second “unknown” decoy distribution (i.e.&nbsp;the uniform distribution) combined with the LTC real spend distribution of ISO week 2022-15.</p></li>
</ol>
<p>The blue line is a close, but not exact, match of the green line. The OSPEAD method estimates the real spend distribution accurately, but it is not perfect. The source of the inaccuracy is likely that ring members are not completely statistically independent, yet the BJR estimator requires independence to work flawlessly.</p>
<div class="page-columns page-full" data-layout-align="center">
<div id="fig-ltc-simulation-cdf" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ltc-simulation-cdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2
</figcaption>
<div aria-describedby="fig-ltc-simulation-cdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/ltc-estimation-simulation-cdf.png" id="fig-ltc-simulation-cdf" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<p>The next plot shows the probability mass functions (PMFs) associated with the CDFs plotted in <a href="#fig-ltc-simulation-cdf" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> . The PMFs were estimated by a simple method: computing the weighted first difference of the CDFs. The vertical axis has a log scale.</p>
<p>Again we see that the estimated and actual LTC real spend distributions follow each other closely. In a few places the estimated PMF is zero. This is an artifact of the Patra-Sen correction that requires the CDF to be valid. These zero-valued PMF points can be smoothed in the parametric distribution fitting step.</p>
<div class="page-columns page-full">
<div id="fig-ltc-simulation-pmf" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ltc-simulation-pmf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3
</figcaption>
<div aria-describedby="fig-ltc-simulation-pmf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/ltc-estimation-simulation-pmf.png" id="fig-ltc-simulation-pmf" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<p>The next chapter, <a href="ring-gathering.html" class="quarto-xref"><span>Chapter 4</span></a>, begins the process to estimate the real spend age distribution of the Monero mainnet blockchain.</p>
</section>
</section>
<section id="is-the-bjr-estimator-necessary" class="level2 page-columns page-full" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="is-the-bjr-estimator-necessary"><span class="header-section-number">3.5</span> Is the BJR estimator necessary?</h2>
<p>The BJR estimator is computationally expensive and consumed the majority of research and development time. Is it necessary? We can re-run the simulation, but skip the BJR step and find out.</p>
<p><a href="#fig-ltc-estimation-simulation-cdf-only-patra-sen" class="quarto-xref">Figure&nbsp;<span>3.4</span></a> shows the results of skipping the BJR step. The estimate is quite inaccurate. It appears to bind against the non-negativity constraint of the Patra-Sen estimator. The KS statistic between this estimate and the real spend CDF is 0.2352.</p>
<div class="page-columns page-full">
<div id="fig-ltc-estimation-simulation-cdf-only-patra-sen" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ltc-estimation-simulation-cdf-only-patra-sen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4
</figcaption>
<div aria-describedby="fig-ltc-estimation-simulation-cdf-only-patra-sen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/ltc-estimation-simulation-cdf-only-patra-sen.png" id="fig-ltc-estimation-simulation-cdf-only-patra-sen" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
<p><a href="#fig-ltc-estimation-simulation-pmf-only-patra-sen" class="quarto-xref">Figure&nbsp;<span>3.5</span></a> shows the PMF of the estimate that skips the BJR estimator.</p>
<div class="page-columns page-full">
<div id="fig-ltc-estimation-simulation-pmf-only-patra-sen" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-ltc-estimation-simulation-pmf-only-patra-sen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5
</figcaption>
<div aria-describedby="fig-ltc-estimation-simulation-pmf-only-patra-sen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="images/ltc-estimation-simulation-pmf-only-patra-sen.png" id="fig-ltc-estimation-simulation-pmf-only-patra-sen" class="img-fluid figure-img column-page">
</div>
</figure>
</div>
</div>
</section>
<section id="sec-successful-simulation-code" class="level2 page-columns page-full" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-successful-simulation-code"><span class="header-section-number">3.6</span> Code</h2>
<div class="cell column-page">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(decoyanalysis)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dRacula)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>n.rings <span class="ot">&lt;-</span> <span class="dv">300000</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>theoretical.mixing.proportions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.93</span>, <span class="fl">0.05</span>, <span class="fl">0.02</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>threads <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>ltc.ecdf.<span class="fl">2022.05</span> <span class="ot">&lt;-</span> qs<span class="sc">::</span><span class="fu">qread</span>(<span class="st">"data/ltc-ecdf-2022-05.qs"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>ltc.ecdf.<span class="fl">2022.10</span> <span class="ot">&lt;-</span> qs<span class="sc">::</span><span class="fu">qread</span>(<span class="st">"data/ltc-ecdf-2022-10.qs"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>ltc.ecdf.<span class="fl">2022.15</span> <span class="ot">&lt;-</span> qs<span class="sc">::</span><span class="fu">qread</span>(<span class="st">"data/ltc-ecdf-2022-15.qs"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span>  <span class="fl">1.4</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="dv">117464545</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># v is the velocity of new outputs being produced on the Monero</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># blockchain, in number of seconds per one new output</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># z is the total number of outputs on the Monero blockchain</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>GAMMA_SHAPE <span class="ot">=</span> <span class="fl">19.28</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>GAMMA_RATE <span class="ot">=</span> <span class="fl">1.61</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  actuar<span class="sc">::</span><span class="fu">plgamma</span>(x, <span class="at">shapelog =</span> GAMMA_SHAPE, <span class="at">ratelog =</span> GAMMA_RATE)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>G_star <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">0</span> <span class="sc">&lt;=</span> x<span class="sc">*</span>v <span class="sc">&amp;</span> x<span class="sc">*</span>v <span class="sc">&lt;=</span> <span class="dv">1800</span>) <span class="sc">*</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">G</span>(x<span class="sc">*</span>v <span class="sc">+</span> <span class="dv">1200</span>) <span class="sc">-</span> <span class="fu">G</span>(<span class="dv">1200</span>) <span class="sc">+</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        ( (x<span class="sc">*</span>v)<span class="sc">/</span>(<span class="dv">1800</span>) ) <span class="sc">*</span> <span class="fu">G</span>(<span class="dv">1200</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">/</span><span class="fu">G</span>(z<span class="sc">*</span>v) <span class="sc">+</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1800</span> <span class="sc">&lt;</span> x<span class="sc">*</span>v <span class="sc">&amp;</span> x<span class="sc">*</span>v <span class="sc">&lt;=</span> z<span class="sc">*</span>v) <span class="sc">*</span> <span class="fu">G</span>(x<span class="sc">*</span>v <span class="sc">+</span> <span class="dv">1200</span>)<span class="sc">/</span><span class="fu">G</span>(z<span class="sc">*</span>v) <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    (z<span class="sc">*</span>v <span class="sc">&lt;</span> x<span class="sc">*</span>v) <span class="sc">*</span> <span class="dv">1</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>G_star.inv <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="cf">function</span>(x) { gbutils<span class="sc">::</span><span class="fu">cdf2quantile</span>(x, <span class="at">cdf =</span> G_star) })</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>ltc.ecdf.<span class="dv">2022</span>.<span class="fl">05.</span>inv <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="cf">function</span>(x) { gbutils<span class="sc">::</span><span class="fu">cdf2quantile</span>(x,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">cdf =</span> <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.05</span>(x) }, <span class="at">lower =</span> <span class="dv">0</span>) })</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>ltc.ecdf.<span class="dv">2022</span>.<span class="fl">10.</span>inv <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="cf">function</span>(x) { gbutils<span class="sc">::</span><span class="fu">cdf2quantile</span>(x,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">cdf =</span> <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.10</span>(x) }, <span class="at">lower =</span> <span class="dv">0</span>) })</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>ltc.ecdf.<span class="dv">2022</span>.<span class="fl">15.</span>inv <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(<span class="cf">function</span>(x) { gbutils<span class="sc">::</span><span class="fu">cdf2quantile</span>(x,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">cdf =</span> <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.15</span>(x) }, <span class="at">lower =</span> <span class="dv">0</span>) })</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>decoy.cdfs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">G_star</span>(x) },</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { triangle<span class="sc">::</span><span class="fu">pltriangle</span>(x, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>, <span class="at">c =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="at">logbase =</span> <span class="fu">exp</span>(<span class="dv">1</span>)) },</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a = 0 is not allowed</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">punif</span>(x, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>) }</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>real.spend.cdfs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.10</span>(x) },</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.05</span>(x) },</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.15</span>(x) }</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>decoy.random.draw <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">G_star.inv</span>(<span class="fu">runif</span>(x)) },</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { triangle<span class="sc">::</span><span class="fu">rltriangle</span>(x, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>, <span class="at">c =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="at">logbase =</span> <span class="fu">exp</span>(<span class="dv">1</span>)) },</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a = 0 is not allowed</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">runif</span>(x, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>) }</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>real.spend.random.draw <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.10.inv</span>(<span class="fu">runif</span>(x)) },</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.05.inv</span>(<span class="fu">runif</span>(x)) },</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) { <span class="fu">ltc.ecdf.2022.15.inv</span>(<span class="fu">runif</span>(x)) }</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">314</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>which.component <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, n.rings, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> theoretical.mixing.proportions)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>which.component <span class="ot">&lt;-</span> <span class="fu">table</span>(which.component)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>ring.generation.threads <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(future<span class="sc">::</span><span class="fu">multisession</span>(<span class="at">workers =</span> ring.generation.threads))</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>rings <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span>(<span class="fu">c</span>(future.apply<span class="sc">::</span><span class="fu">future_replicate</span>(<span class="dv">15</span>, decoy.random.draw[[x]](which.component[x]))), <span class="at">ncol =</span> <span class="dv">15</span>),</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span>(real.spend.random.draw[[x]](which.component[x]), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>rings <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, rings)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>rings.untransformed <span class="ot">&lt;-</span> rings</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>rings[rings <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> rings[rings <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="sc">+</span> <span class="fl">0.1</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>rings <span class="ot">&lt;-</span> <span class="fu">log</span>(rings)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>cdf.points <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">c</span>(rings), <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, (<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)<span class="sc">/</span><span class="dv">100</span>, <span class="fl">0.999</span>))</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>II <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>cluster.threads <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">future.globals.maxSize =</span> <span class="dv">8000</span><span class="sc">*</span><span class="dv">1024</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(future<span class="sc">::</span><span class="fu">multisession</span>(<span class="at">workers =</span> threads))</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> rings</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">system.time</span>(bjr.results <span class="ot">&lt;-</span> <span class="fu">bjr</span>(y, <span class="at">II =</span> II, <span class="at">K =</span> K, <span class="at">cdf.points =</span> cdf.points,</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate.mean.sd =</span> <span class="cn">FALSE</span>, <span class="at">basis =</span> <span class="st">"Chebychev"</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">cluster.threads =</span> cluster.threads ))))</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>wallet2.dist.index <span class="ot">&lt;-</span> <span class="fu">which.max</span>(bjr.results<span class="sc">$</span>mixing.proportions)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>Fn.hat.value <span class="ot">&lt;-</span> bjr.results<span class="sc">$</span>cdf<span class="sc">$</span>CDF[, wallet2.dist.index]</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>supp.points <span class="ot">&lt;-</span> bjr.results<span class="sc">$</span>cdf<span class="sc">$</span>cdf</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>supp.points <span class="ot">&lt;-</span> <span class="fu">expm1</span>(supp.points)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>Fb <span class="ot">&lt;-</span> decoy.cdfs[[<span class="dv">1</span>]]</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="dv">16</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>M</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>patra.sen.bjr.results <span class="ot">&lt;-</span> <span class="fu">patra.sen.bjr</span>(Fn.hat.value, supp.points, Fb, alpha)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> bjr.results<span class="sc">$</span>cdf<span class="sc">$</span>cdf.points</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">expm1</span>(x)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Estimated mixing proportions of distribution components:"</span>,</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="fu">sort</span>(bjr.results<span class="sc">$</span>mixing.proportions, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), <span class="dv">4</span>), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Kolmogorov–Smirnov statistic (i.e. maximum distance between two CDFs) of estimated and actual LTC real spend:"</span>,</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">abs</span>(real.spend.cdfs[[<span class="dv">1</span>]](x) <span class="sc">-</span> patra.sen.bjr.results<span class="sc">$</span>Fs.hat)), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>plot.data.cdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x, </span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(real.spend.cdfs[[<span class="dv">1</span>]](x),</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>  patra.sen.bjr.results<span class="sc">$</span>Fs.hat,</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  decoy.cdfs[[<span class="dv">1</span>]](x),</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  alpha <span class="sc">*</span> real.spend.cdfs[[<span class="dv">2</span>]](x) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>alpha) <span class="sc">*</span> decoy.cdfs[[<span class="dv">2</span>]](x),</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  alpha <span class="sc">*</span> real.spend.cdfs[[<span class="dv">3</span>]](x) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>alpha) <span class="sc">*</span> decoy.cdfs[[<span class="dv">3</span>]](x)</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="fu">length</span>(x) ))</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Must manualy put in the values of theoretical.mixing.proportions</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a><span class="co"># because doing it automatically is complicated.</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>distribution.legend.text <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Empirical real spend of</span><span class="sc">\n</span><span class="st">LTC, ISO week 2022-10"</span>)),</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"BJR + Patra-Sen est. of</span><span class="sc">\n</span><span class="st">wallet2-associated real spend"</span>)),</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">atop</span>(<span class="fu">phantom</span>(<span class="dv">0</span>), <span class="fu">atop</span>(<span class="fu">paste</span>(<span class="st">"Theoretical wallet2 decoy distribution, "</span>,</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    omega <span class="sc">==</span> <span class="fl">0.93</span>, <span class="st">""</span>), <span class="fu">paste</span>(<span class="st">"Log-gamma, shape = 19.28, rate = 1.61"</span>)))),</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">atop</span>(<span class="fu">phantom</span>(<span class="dv">0</span>), <span class="fu">atop</span>(<span class="fu">paste</span>(<span class="st">'Theor. "unknown" decoy #1 + LTC_2022-05 real. '</span>,</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    omega <span class="sc">==</span> <span class="fl">0.05</span>, <span class="st">""</span>), <span class="fu">paste</span>(<span class="st">"Log-triangular, min = 0, max = 1 year, mode = 1 week"</span>)))),</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">atop</span>(<span class="fu">phantom</span>(<span class="dv">0</span>), <span class="fu">atop</span>(<span class="fu">paste</span>(<span class="st">'Theor. "unknown" decoy #2 + LTC_2022-15 real.'</span>),</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(omega <span class="sc">==</span> <span class="fl">0.02</span>, <span class="st">", Uniform, min = 0, max = 1 year"</span>))))</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>dracula.palette <span class="ot">&lt;-</span> dracula_tibble<span class="sc">$</span>hex[<span class="fu">seq_len</span>(data.table<span class="sc">::</span><span class="fu">uniqueN</span>(plot.data.cdf<span class="sc">$</span>label))]</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dracula.palette) <span class="ot">&lt;-</span> <span class="fu">unique</span>(plot.data.cdf<span class="sc">$</span>label)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span> <span class="fu">dir.exists</span>(<span class="st">"images"</span>)) { <span class="fu">dir.create</span>(<span class="st">"images"</span>) }</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/ltc-estimation-simulation-cdf.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.data.cdf,</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Simulated estimation of LTC real spend CDF using BJR + Patra-Sen"</span>,</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative distribution function (CDF)"</span>,</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">60</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>),</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hour"</span>, <span class="st">"12 hour"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> dracula.palette, <span class="at">name =</span> <span class="st">''</span>, </span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> distribution.legend.text, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>)))</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>plot.data.pmf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(real.spend.cdfs[[<span class="dv">1</span>]](x)) <span class="sc">/</span> <span class="fu">diff</span>(x),</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(patra.sen.bjr.results<span class="sc">$</span>Fs.hat) <span class="sc">/</span> <span class="fu">diff</span>(x),</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(decoy.cdfs[[<span class="dv">1</span>]](x)) <span class="sc">/</span> <span class="fu">diff</span>(x),</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(alpha <span class="sc">*</span> real.spend.cdfs[[<span class="dv">2</span>]](x) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>alpha) <span class="sc">*</span> decoy.cdfs[[<span class="dv">2</span>]](x)) <span class="sc">/</span> <span class="fu">diff</span>(x),</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(alpha <span class="sc">*</span> real.spend.cdfs[[<span class="dv">3</span>]](x) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>alpha) <span class="sc">*</span> decoy.cdfs[[<span class="dv">3</span>]](x)) <span class="sc">/</span> <span class="fu">diff</span>(x)</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="fu">length</span>(x) <span class="sc">-</span> <span class="dv">1</span> ))</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/ltc-estimation-simulation-pmf.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.data.pmf,</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Simulated estimation of LTC real spend PMF using BJR + Patra-Sen"</span>,</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability mass function (PMF) (Log scale)"</span>,</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a> <span class="co"># coord_cartesian(ylim = c(0.00000000001, 0.1)) +</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">60</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>),</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hour"</span>, <span class="st">"12 hour"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> dracula.palette, <span class="at">name =</span> <span class="st">''</span>, </span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> distribution.legend.text, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>)))</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative LTC estimation with only Patra-Sen</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>rings.ecdf <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(<span class="fu">c</span>(rings.untransformed))</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>supp.points <span class="ot">&lt;-</span> <span class="fu">knots</span>(rings.ecdf)[<span class="fu">floor</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(<span class="fu">knots</span>(rings.ecdf)), <span class="at">length.out =</span> <span class="dv">101</span>))]</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>Fn.hat.value <span class="ot">&lt;-</span> <span class="fu">rings.ecdf</span>(supp.points)</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>Fb <span class="ot">&lt;-</span> decoy.cdfs[[<span class="dv">1</span>]]</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="dv">16</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>M</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>patra.sen.bjr.results <span class="ot">&lt;-</span> <span class="fu">patra.sen.bjr</span>(Fn.hat.value, supp.points, Fb, alpha)</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> supp.points</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Kolmogorov–Smirnov statistic (i.e. maximum distance between two CDFs) of estimated and actual LTC real spend:"</span>,</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">abs</span>(real.spend.cdfs[[<span class="dv">1</span>]](x) <span class="sc">-</span> patra.sen.bjr.results<span class="sc">$</span>Fs.hat)), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>plot.data.cdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x, </span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(real.spend.cdfs[[<span class="dv">1</span>]](x),</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    patra.sen.bjr.results<span class="sc">$</span>Fs.hat</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="fu">length</span>(x) ))</span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: Must manualy put in the values of theoretical.mixing.proportions</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a><span class="co"># because doing it automatically is complicated.</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>distribution.legend.text <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Empirical real spend of LTC, ISO week 2022-10"</span>)),</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Patra-Sen est. of wallet2-associated real spend"</span>)),</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">atop</span>(<span class="fu">phantom</span>(<span class="dv">0</span>), <span class="fu">atop</span>(<span class="fu">paste</span>(<span class="st">"Theoretical wallet2 decoy distribution, "</span>,</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    omega <span class="sc">==</span> <span class="fl">0.93</span>, <span class="st">""</span>), <span class="fu">paste</span>(<span class="st">"Log-gamma, shape = 19.28, rate = 1.61"</span>)))),</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">atop</span>(<span class="fu">phantom</span>(<span class="dv">0</span>), <span class="fu">atop</span>(<span class="fu">paste</span>(<span class="st">'Theor. "unknown" decoy #1 + LTC_2022-05 real. '</span>,</span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    omega <span class="sc">==</span> <span class="fl">0.05</span>, <span class="st">""</span>), <span class="fu">paste</span>(<span class="st">"Log-triangular, min = 0, max = 1 year, mode = 1 week"</span>)))),</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expression</span>(<span class="fu">atop</span>(<span class="fu">phantom</span>(<span class="dv">0</span>), <span class="fu">atop</span>(<span class="fu">paste</span>(<span class="st">'Theor. "unknown" decoy #2 + LTC_2022-15 real.'</span>),</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(omega <span class="sc">==</span> <span class="fl">0.02</span>, <span class="st">", Uniform, min = 0, max = 1 year"</span>))))</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>dracula.palette <span class="ot">&lt;-</span> dracula_tibble<span class="sc">$</span>hex[<span class="fu">seq_len</span>(data.table<span class="sc">::</span><span class="fu">uniqueN</span>(plot.data.cdf<span class="sc">$</span>label))]</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dracula.palette) <span class="ot">&lt;-</span> <span class="fu">unique</span>(plot.data.cdf<span class="sc">$</span>label)</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span> <span class="fu">dir.exists</span>(<span class="st">"images"</span>)) { <span class="fu">dir.create</span>(<span class="st">"images"</span>) }</span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/ltc-estimation-simulation-cdf-only-patra-sen.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.data.cdf,</span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Simulated estimation of LTC real spend CDF using only Patra-Sen"</span>,</span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative distribution function (CDF)"</span>,</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">60</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>),</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hour"</span>, <span class="st">"12 hour"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> dracula.palette, <span class="at">name =</span> <span class="st">''</span>, </span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> distribution.legend.text, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>)))</span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>plot.data.pmf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x[<span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(real.spend.cdfs[[<span class="dv">1</span>]](x)) <span class="sc">/</span> <span class="fu">diff</span>(x),</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(patra.sen.bjr.results<span class="sc">$</span>Fs.hat) <span class="sc">/</span> <span class="fu">diff</span>(x)</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="fu">length</span>(x) <span class="sc">-</span> <span class="dv">1</span> ))</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"images/ltc-estimation-simulation-pmf-only-patra-sen.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">1000</span>)</span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot.data.pmf,</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Simulated estimation of LTC real spend PMF using only Patra-Sen"</span>,</span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability mass function (PMF) (Log scale)"</span>,</span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Output age (log scale)"</span>) <span class="sc">+</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(0.00000000001, 0.1)) +</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">60</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">*</span><span class="dv">30</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">12</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">7</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">28</span>, <span class="dv">60</span><span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">365</span>),</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1 sec"</span>, <span class="st">"10 sec"</span>, <span class="st">"1 min"</span>, <span class="st">"2 min"</span>, <span class="st">"30 min"</span>, <span class="st">"1 hour"</span>, <span class="st">"12 hour"</span>, <span class="st">"1 day"</span>, <span class="st">"1 week"</span>, <span class="st">"1 month"</span>, <span class="st">"1 year"</span>)) <span class="sc">+</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_colour_brewer(palette = "Dark2") +</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dracula</span>() <span class="sc">+</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> dracula.palette, <span class="at">name =</span> <span class="st">''</span>, </span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> distribution.legend.text, <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">linewidth =</span> <span class="dv">5</span>)))</span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a><span class="co"># The order of the themes() matter. Must have theme_dracula() first.</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Bonhomme2016" class="csl-entry" role="listitem">
Bonhomme, Stéphane, Koen Jochmans, and Jean-Marc Robin. 2016. <span>“Non-Parametric Estimation of Finite Mixtures from Repeated Measurements.”</span> <em>Journal of the Royal Statistical Society. Series B (Statistical Methodology)</em> 78 (1): 211–29. <a href="http://www.jstor.org/stable/24775334">http://www.jstor.org/stable/24775334</a>.
</div>
<div id="ref-Noether2014" class="csl-entry" role="listitem">
Noether, Surae, Sarang Noether, and Adam Mackenzie. 2014. <span>“A Note on Chain Reactions in Traceability in CryptoNote 2.0.”</span> Research Bulletin. <a href="https://www.getmonero.org/resources/research-lab/pubs/MRL-0001.pdf">https://www.getmonero.org/resources/research-lab/pubs/MRL-0001.pdf</a>.
</div>
<div id="ref-Patra2016" class="csl-entry" role="listitem">
Patra, Rohit Kumar, and Bodhisattva Sen. 2016. <span>“Estimation of a Two-Component Mixture Model with Applications to Multiple Testing.”</span> <em>Journal of the Royal Statistical Society. Series B (Statistical Methodology)</em> 78 (4): 869–93. <a href="http://www.jstor.org/stable/24775367">http://www.jstor.org/stable/24775367</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./requirements.html" class="pagination-link" aria-label="Requirements">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Requirements</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ring-gathering.html" class="pagination-link" aria-label="Ring Gathering">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ring Gathering</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>