{"title":"Broadcast Time","markdown":{"headingText":"Broadcast Time","containsRefs":false,"markdown":"\nA transaction's distribution of decoys is based on the time of transaction construction, not on the time that it is confirmed on the blockchain. Since most transactions are confirmed shortly after being broadcast, blockchain confirmation time is nonetheless a good approximation of transaction construction time. However, we can improve over this approximation by using ephemeral data about when broadcasted transactions arrived in nodes' txpools, which has been collected since late December 2022.\n\nThe transaction construction times are computed as follows:\n\n- From August 2022 to December 2022, txpool archive data is not available. During this period of time, most mining pools delayed first confirmation by one block [@Rucknium2023a]. Therefore, the block height of construction of every transaction during this period is assumed to be two blocks before the block it was confirmed in. It is two blocks instead of one because a transaction cannot be constructed based on the data in its own block, since the wallet wouldn't have the block information yet at the time of construction.\n\n- For the remainder of the data (with an exception explained below), the block height of construction was assumed to be the current block height at the time that nodes received the transaction in their txpools. If a transaction appeared on the blockchain but not in the txpool data, it is assumed that the transaction was constructed immediately prior to the block it was confirmed in.\n\n- ISO weeks 2023-13 and 2023-14 are missing txpool data. Data from these weeks will be excluded from the later analysis.\n\nThe largest discrepancy between the time of construction and time of confirmation occurred during the March 2024 suspected spam attack [@Rucknium2024a].\n\nThis code should be run in the same R session as previous chapters.\n\n## Code\n\n```{r}\n#| column: page\n\n\nthreads <- 16\nfuture::plan(future::multisession(workers = threads))\n\n\nblocks <- rbind(\nfread(\"xmr-block-archive-2023-01-18-20-48-07.csv\"),\nfread(\"xmr-block-archive-2023-03-09-12-20-37.csv\"),\nfread(\"xmr-block-archive-2024-01-14-07-00-47.csv\"),\nfread(\"xmr-block-archive-2024-03-11-20-32-01.csv\"),\nfread(\"xmr-block-archive-2023-12-27-20-14-43.csv\"),\nfread(\"xmr-block-archive-exporttime-2024-10-20-21-39-50.csv\"),\nfread(\"xmr-block-archive-exporttime-2024-10-21-17-06-02.csv\")\n)\n\n\n\nblocks <- blocks[blocks$block_height != 0, ]\nsetorder(blocks, block_height, block_receive_time)\nblocks <- unique(blocks, by = \"block_height\")\n\n\nmempool <- rbind(\nfread(\"xmr-mempool-archive-2023-01-18-20-48-07.csv\"),\nfread(\"xmr-mempool-archive-2023-03-09-12-20-37.csv\"),\nfread(\"xmr-mempool-archive-2024-01-14-07-00-47.csv\"),\nfread(\"xmr-mempool-archive-2024-03-11-20-32-01.csv\"),\nfread(\"xmr-mempool-archive-2023-12-27-20-14-43.csv\"),\nfread(\"xmr-txpool-archive-exporttime-2024-10-20-21-39-50.csv\"),\nfread(\"xmr-txpool-archive-exporttime-2024-10-21-17-06-02.csv\")\n)\n\n\nsetorder(mempool, receive_time)\nmempool <- unique(mempool, by = \"id_hash\")\n\nsetnames(blocks, \"block_receive_time\", \"canon.block_receive_time\")\nsetnames(mempool, \"receive_time\", \"canon.receive_time\")\n\n# Some of this script taken from https://github.com/Rucknium/misc-research/blob/main/Monero-TX-Confirm-Delay/xmr-data-prep.R\n\n\nblock_height.unique <- blocks[, na.omit(unique(block_height))]\n\nall.blocks <- min(block_height.unique[block_height.unique > 0]):max(block_height.unique)\n# min():max() since some blocks are \"skipped\"\n# Need to have positive since rarely block height is corrupted  in RPC response\n# to \"0\"\n\n\n\nblockchain.data <- future.apply::future_lapply(seq_along(all.blocks), function(i) {\n\n  block.data <- xmr.rpc(url.rpc = \"http://127.0.0.1:58081/json_rpc\", method = \"get_block\",\n    params = list(height = all.blocks[i]))$result\n\n  if (length(block.data$tx_hashes) > 0) {\n    y <- data.table::data.table(\n      block_height = all.blocks[i],\n      id_hash = block.data$tx_hashes,\n      block_num_txes = block.data$block_header$num_txes,\n      block_reward = block.data$block_header$reward\n    )\n  } else {\n    y <- data.table::data.table(\n      block_height = all.blocks[i],\n      id_hash = \"<NO_TXS_IN_BLOCK>\",\n      block_num_txes = block.data$block_header$num_txes,\n      block_reward = block.data$block_header$reward\n    )\n  }\n  return(y)\n})\n\n\nblockchain.data <- data.table::rbindlist(blockchain.data)\n\nblocks.filled <- merge(data.table(block_height = all.blocks),\n  blocks[, c(\"block_height\", \"canon.block_receive_time\")], all = TRUE)\n\nrm(blocks)\n\nblocks.filled$canon.block_receive_time <- zoo::na.locf(blocks.filled$canon.block_receive_time, fromLast = TRUE)\n\nblockchain.data <- merge(blocks.filled, blockchain.data)\n\nblockchain.data <- merge(blockchain.data, mempool, by = \"id_hash\", all = TRUE)\n\nrm(mempool)\n\n\n\nmempool.archive.blocks <- unique(blockchain.data[, .(block_height, canon.block_receive_time)])\nmempool.archive.blocks <- mempool.archive.blocks[complete.cases(mempool.archive.blocks), ]\n# As of now, this only eliminates a single row that has block_height = NA, canon.block_receive_time = NA\nmempool.archive.blocks <- rbind(mempool.archive.blocks,\n  data.table(block_height = min(mempool.archive.blocks$block_height), canon.block_receive_time = 0))\n# Fill in missing data from beginning of dataset when we findInterval() below\nsetorder(mempool.archive.blocks, canon.block_receive_time)\n\nblockchain.data[, block_height.at.construction :=\n  mempool.archive.blocks$block_height[findInterval(canon.receive_time, mempool.archive.blocks$canon.block_receive_time)] ]\n\nblockchain.data[block_height - block_height.at.construction <= 0, block_height.at.construction := block_height - 1]\n\nsetnames(blockchain.data, \"block_height.at.construction\", \"block_height_ring.at.construction\")\n\nblockchain.data <- blockchain.data[ (! duplicated(id_hash)) | id_hash == \"<NO_TXS_IN_BLOCK>\", ]\n\nxmr.rings <- merge(xmr.rings, blockchain.data[, .(id_hash, block_height_ring.at.construction)], by.x = \"tx_hash\", by.y = \"id_hash\", all.x = TRUE)\n\nrm(blockchain.data)\n\nxmr.rings[substr(block_timestamp_ring_isoweek, 1, 4) == 2022, block_height_ring.at.construction := block_height_ring - 2]\n# Assume all txs had a delay of one block, before the mining pool config fix in January 2023.\n\n\nweeks.missing.mempool.data <- c(\"2023-13\", \"2023-14\")\n\nxmr.rings[ is.na(block_height_ring.at.construction) & ! block_timestamp_ring_isoweek %chin% weeks.missing.mempool.data,\n  block_height_ring.at.construction := block_height_ring - 1]\n# The rest, if the tx \"skipped\" the mempool, assume that the tx was constructed right before the block it was\n# confirmed in. Exclude 2023-13 and 2023-14 weeks since we are missing mempool data for those weeks.\n\n\nstopifnot(all(complete.cases(\n  xmr.rings[! block_timestamp_ring_isoweek %chin% weeks.missing.mempool.data,\n   .(block_height_ring.at.construction, youngest.output.index, ring_member_age)]))\n)\n\n\n\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"gruvbox","html-math-method":"mathml","output-file":"broadcast-time.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","bibliography":["references.bib"],"bibliographystyle":"apa","editor":"visual","theme":"superhero","fig-cap-location":"top"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"broadcast-time.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"bibliographystyle":"apa","editor":"visual","documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}